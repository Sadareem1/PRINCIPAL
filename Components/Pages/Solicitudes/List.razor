@page "/solicitudes"
@attribute [Authorize(Policy = "SoloLectura")]
@inject ISolicitudesService SolicitudesService
@inject NavigationManager Navigation

<h1>Solicitudes</h1>

<AuthorizeView Roles="Administrador,Tecnico,Consulta">
    <button class="btn btn-primary" @onclick='() => Navigation.NavigateTo("/solicitudes/nueva")'>Nueva solicitud</button>
</AuthorizeView>

<DataTable>
    <Header>
        <tr>
            <th>Solicitante</th>
            <th>Tipo</th>
            <th>Prioridad</th>
            <th>Estado</th>
            <th>Fecha creaci√≥n</th>
        </tr>
    </Header>
    <Body>
        @foreach (var solicitud in Solicitudes)
        {
            <tr>
                <td>@solicitud.SolicitanteId</td>
                <td>@solicitud.Tipo</td>
                <td>@solicitud.Prioridad</td>
                <td>@solicitud.Estado</td>
                <td>@solicitud.FechaCreacion.ToShortDateString()</td>
            </tr>
        }
    </Body>
</DataTable>

@code {
    private List<Solicitud> Solicitudes { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        Solicitudes = (await SolicitudesService.ListarAsync(null, null)).ToList();
    }
}
